from django.contrib.auth.models import Group, Permission
from django.contrib.contenttypes.models import ContentType

def update_intergrator_permissions():
    """
    Add missing integrator permissions to integrator groups that are already existing in DB
    """

    integrator_groups = Group.objects.filter(permitdepartment__is_integrator_admin=True)

    permits_permissions = Permission.objects.filter(
        content_type__app_label="permits",
        content_type__model__in=admin.INTEGRATOR_PERMITS_MODELS_PERMISSIONS,
    )

    other_permissions = Permission.objects.filter(
        codename__in=admin.OTHER_PERMISSIONS_CODENAMES
    )

    for integrator_group in integrator_groups:

        # set the required permissions for the integrator group
        integrator_group.permissions.set(
            permits_permissions.union(other_permissions)
        )
